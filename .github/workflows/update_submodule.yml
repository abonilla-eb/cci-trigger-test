# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. 
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  
  repository_dispatch:
    types: [update_server, update_django, update_quoridor]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  update_server:
    runs-on: ubuntu-latest
    if: $GITHUB_EVENT_NAME == update_server
    steps:
    - name: Temporarily disable "include administrators" branch protection
      uses: benjefferies/branch-protection-bot@master
      if: always()
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: main
    - name: Deploy
      run: |
        git submodule update --init --remote -- edagames-server
    - name: Enable "include administrators" branch protection
      uses: benjefferies/branch-protection-bot@master
      if: always()
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: main

  update_django:
    runs-on: ubuntu-latest
    if: GITHUB_EVENT_NAME == update_django
    steps:
    - name: Temporarily disable "include administrators" branch protection
      uses: benjefferies/branch-protection-bot@master
      if: always()
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: main
    - name: Deploy
      run: |
        git submodule update --init --remote -- edagames-django
    - name: Enable "include administrators" branch protection
      uses: benjefferies/branch-protection-bot@master
      if: always()
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: main

  update_quoridor:
    runs-on: ubuntu-latest
    if: GITHUB_EVENT_NAME == update_quoridor
    steps:
    - name: Temporarily disable "include administrators" branch protection
      uses: benjefferies/branch-protection-bot@master
      if: always()
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: main
    - name: Deploy
      run: |
        git submodule update --init --remote -- edagames-quoridor
    - name: Enable "include administrators" branch protection
      uses: benjefferies/branch-protection-bot@master
      if: always()
      with:
        access-token: ${{ secrets.ACCESS_TOKEN }}
        branch: main
